[gd_scene load_steps=4 format=2]

[ext_resource path="res://PrototypeEntity.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

onready var SpritePivot : Position2D = $SpritePivot
onready var BulletOrigin : Position2D = $SpritePivot/Sprite/BulletOrigin

const BULLET := preload(\"res://PrototypePlayerBullet.tscn\")

export (float) var move_speed := 50.0

var input_direction : Vector2
var last_mouse_position

func _unhandled_input(event):
	if event is InputEventMouse:
		last_mouse_position = event.global_position
	elif event.is_action_pressed(\"ui_select\"):
		shoot()

func _physics_process(delta):
	SpritePivot.rotation = last_mouse_position.angle_to_point(global_position)
	
	input_direction = Vector2(int(Input.is_action_pressed(\"ui_right\")) - int(Input.is_action_pressed(\"ui_left\")),
			int(Input.is_action_pressed(\"ui_down\")) - int(Input.is_action_pressed(\"ui_up\"))).normalized()
	
	move_and_slide(input_direction * move_speed)

func shoot():
	var bullet = BULLET.instance()
	bullet.angle = SpritePivot.rotation
	bullet.global_position = BulletOrigin.global_position
	get_parent().add_child(bullet)"

[sub_resource type="CircleShape2D" id=2]

[node name="PrototypePlayer" type="KinematicBody2D"]
collision_layer = 4
collision_mask = 3
script = SubResource( 1 )
__meta__ = {
"_edit_group_": true
}

[node name="SpritePivot" type="Position2D" parent="."]
editor/display_folded = true

[node name="Sprite" type="Sprite" parent="SpritePivot"]
editor/display_folded = true
texture = ExtResource( 1 )

[node name="BulletOrigin" type="Position2D" parent="SpritePivot/Sprite"]
position = Vector2( 10, 0 )

[node name="Collision" type="CollisionShape2D" parent="."]
shape = SubResource( 2 )
